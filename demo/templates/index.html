<!DOCTYPE html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,600" rel="stylesheet">
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'>
    <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/loader.css') }}">
    <link rel="stylesheet" type="text/css" href="../static/styles/loader.css">

    <style>
      body {
        font-family: 'Raleway', sans-serif;
      }

      #header{
        padding-top: 50px;
        padding-bottom: 50px;
        margin-bottom: 10px;
        background-size:cover;
        background-image: url("../static/images/cc-bg.jpg");
      }
      #header h1 {
        color: white;
      }
      #question-input-form {
        margin-top: 20px;
      }
      #main-content {
        padding: 10px;
        margin-right: 10px;
        margin-left: 10px;
      }
      #questionInput {
        border: 1px solid #212121;
      }
      #paragraphTextArea {
        resize: none;
        border: 1px solid #212121;
      }
      #paragraphTextArea::-webkit-input-placeholder { /* WebKit browsers */
        opacity: 0.8 !important;
      }
      #run-model-button {
        padding-left: 10px;
        padding-right: 10px;
        margin-left: 15px;
      }
      #run-compare-button {
        padding-left: 10px;
        padding-right: 10px;
        margin-left: 10px;
      }
      .paragraph_sentence, .top-sentence {
        color: black
      }
      .paragraph_sentence:hover, .top-sentence:hover {
        color: red
      }
      #top-1-phrase {
        background-color: rgba(255, 255, 0, 1.0)
      }
      #top-2-phrase {
        /* The background color will change to rgba(255, 255, 0, 0.25)
        when the option "Show top-3 sentences" is selected.*/
        background-color: white
      }
      #top-3-phrase {
        /* The background color will change to rgba(255, 255, 0, 0.10)
        when the option "Show top-3 sentences" is selected.*/
        background-color: white
      }
    </style>
  </head>

  <body>
    <div id="header">
      <div class="container text-center">
          <h1>SmartFind Phrase Search Demo</h1>
      </div>
    </div>

    <div id="main-content" class="row">
      <div class="col-md-6">
        <p>This is a web application demonstrating the use of a state-of-the-art
          model for phrase search. Given a paragraph and a query, the
          application will identify the phrases in the paragraph that are
          most relevant to the query.</p>
        </br>
        <span>Enter text or </span>
        <select id="example-paragraph-select" data-style="btn-primary">
          <option value="none">Choose an example ...</option>
          {% for example in examples %}
            <option value="{{ example.id }}">{{ example.title}}</option>
          {% endfor %}
        </select>
        </br>
        </br>
        <form>
          <div class="form-group">
            <label for="paragraphTextArea"><b>Paragraph</b></label>
            <textarea maxlength="100000" class="form-control" id="paragraphTextArea" rows="5" placeholder="E.g. &quot;Photosynthesis is a process used by plants and other organisms to convert light energy into chemical energy that can later be released to fuel the organisms' activities (energy transformation). This chemical energy is stored in carbohydrate molecules, such as sugars, which are synthesized from carbon dioxide and water â€“ hence the name photosynthesis.&quot;"></textarea>
            <small><label id="characterCountLabel" for="paragraphTextArea">Number of characters left: 100000</label></small>
          </div>
          <div class="form-group">
            <label for="questionInput"><b>Query</b></label>
            <input class="form-control" id="questionInput" placeholder="E.g. &quot;corona virus&quot;">
          </div>

          <div class="form-group">
            <label for="answerInput"><b>Answer</b></label>
            <span id="answerInput"></span>
          </div>

          <div class="form-group">
              <select id="extract_select" data-style="btn-primary">
                <option value="ngrams">ngrams</option>
                <option value="noun_chunks" selected>noun_chunks</option>
              </select> &nbsp;&nbsp;
              <select id="score_select" data-style="btn-primary">
                <option value="fasttext" selected>fasttext</option>
                <option value="bert">bert-avg2</option>
                <option value="sentbert">sentbert-ms</option>
                <option value="use">use-v4</option>
              </select>
              <button type="button" id="run-model-button" class="btn btn-primary" onClick="onRunModelButtonClicked()">Single Model</button>
              <button type="button" id="run-compare-button" class="btn btn-primary pull-right" onClick="onRunCompareButtonClicked()">Compare All</button>             

              
          </div>

          <div class="form-group">
            <!--
            <table>
              <tr>
                <td>
                  <input type="checkbox" id="acronym" name="acronym" value="acronym">
                  <label for="acronym"> Acronym </label>
                </td>
                <td width="60px"></td>
                <td>
                  <input type="checkbox" id="date" name="date" value="date">
                  <label for="date"> Date </label>
                </td>
              </tr>
              <tr>
                <td>
                  <input type="checkbox" id="name" name="name" value="name">
                  <label for="name"> Name </label>
                </td>
                <td></td>
                <td>
                  <input type="checkbox" id="number" name="number" value="number">
                  <label for="number"> Number </label>
                </td>
              </tr>
            </table>
            -->
          </div>
        </form>
      </div>
      <div class="col-md-6">
        <div id="loader" class="d-none">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="lading"></div>
        </div>
        <div id="result" class="d-none">
          <div class="checkbox">
            <label><input id="show-top-3-checkbox" type="checkbox"> Show top-3 sentences</label>
          </div>
          <div id="result-sentences-container">
          </div>
          <div id="result-sentences-container2">
          </div>
        </div>
      </div>
    </div>

    <div id="converter-div" style="display:none"></div>

    <script>
      let exampleParagraphs = {}
      var tmpParagraph = {}
      {% for example in examples %}
        tmpParagraph = {}
        tmpParagraph['id'] = $("#converter-div").html("{{ example.id}}").text()
        tmpParagraph['title'] = $("#converter-div").html("{{ example.title }}").text()
        tmpParagraph['content'] = $("#converter-div").html("{{ example.context }}").text()
        tmpParagraph['example_query'] = $("#converter-div").html("{{ example.query }}").text()
        tmpParagraph['answer'] = $("#converter-div").html("{{ example.answers['text'][0] }}").text()
        exampleParagraphs[tmpParagraph['id']] = tmpParagraph
      {% endfor %}

      $("#example-paragraph-select").change(function() {
        let selectedParagraphID = $("#example-paragraph-select").val()
        if (selectedParagraphID == "none") {
          $("#paragraphTextArea").val("")
          $('#questionInput').val("")
          document.getElementById("answerInput").textContent= ""
        } else {
          let selectedParagraph = exampleParagraphs[selectedParagraphID]
          $("#paragraphTextArea").val(selectedParagraph.content)
          $('#questionInput').val(selectedParagraph.example_query)
          $('#answerInput').innerHTML = selectedParagraph.answer
          document.getElementById("answerInput").textContent = selectedParagraph.answer
          console.log(selectedParagraph.answer)
        }
        updateCharacterCountLabel()
      });

      $(document).on("keypress", 'form', function (e) {
          var code = e.keyCode || e.which;
          if (code == 13) {
              e.preventDefault();
              return false;
          }
      });

      $('#show-top-3-checkbox').change(function() {
        if($(this).is(":checked")) {
          $('#top-2-phrase').css('background-color', 'rgba(255, 255, 0, 0.25)')
          $('#top-3-phrase').css('background-color', 'rgba(255, 255, 0, 0.10)')
        } else {
          $('#top-2-phrase').css('background-color', 'white')
          $('#top-3-phrase').css('background-color', 'white')
        }
    });

      function updateCharacterCountLabel() {
        var maxlength = $('#paragraphTextArea').attr("maxlength");
        var currentLength = $('#paragraphTextArea').val().length;
        if (currentLength >= maxlength ){
            $("#characterCountLabel").html("You have reached the maximum number of characters.")
        } else {
          var nbCharactersLeft = maxlength - currentLength
          $("#characterCountLabel").html("Number of characters left: " + nbCharactersLeft)
        }
      }

      $('#paragraphTextArea').on("input", function(){
        updateCharacterCountLabel()
      });

      function RGBA(red,green,blue,alpha) {
          this.red = red;
          this.green = green;
          this.blue = blue;
          this.alpha = alpha;
          this.getCSS = function() {
              return "rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")";
          }
      }

      function onRunModelButtonClicked() {
        var paragraphText = $('#paragraphTextArea').val().trim();
        var questionText = $('#questionInput').val().trim();
        var extractorName = $('#extract_select').find(":selected").text();
        var scorerName = $('#score_select').find(":selected").val();
        var acronym = $('#acronym').is(":checked")?true:false
        var date = $('#date').is(":checked")?true:false
        var name = $('#name').is(":checked")?true:false
        var number = $('#number').is(":checked")?true:false
        
        // Hide the RunModelButton
        $('#run-model-button').addClass('d-none')
        $('#run-compare-button').addClass('d-none')

        // Show the loading animation and hide the result div
        $('#loader').removeClass('d-none')
        $('#result').addClass('d-none')

        // Make a POST request
        var data = new FormData();
        data.append('paragraph_text', paragraphText);
        data.append('question_text', questionText);
        data.append('extractor', extractorName);
        data.append('scorer', scorerName);
        data.append('acronym', acronym);
        data.append('date', date);
        data.append('name', name);
        data.append('number', number);

        let url = "answer";
        $.ajax({
          url: url,
          data: data,
          cache: false,
          contentType: false,
          processData: false,
          method: 'POST',
          success: function(data){
            $('#result-sentences-container').empty()

            var resultHTML = data['html'];
            $('#result-sentences-container').append("<p>" + resultHTML + "</p>")             

            // The following code will enable all tooltips in the document
            $('[data-toggle="tooltip"]').tooltip();

            // Check if showing the top-3 sentences
            if($('#show-top-3-checkbox').is(":checked")) {
              $('#top-2-phrase').css('background-color', 'rgba(255, 255, 0, 0.25)')
              $('#top-3-phrase').css('background-color', 'rgba(255, 255, 0, 0.10)')
            } else {
              $('#top-2-phrase').css('background-color', 'white')
              $('#top-3-phrase').css('background-color', 'white')
            }

            // Hide the loading animation and show the result div
            $('#loader').addClass('d-none')
            $('#result').removeClass('d-none')

            // Show the RunModelButton
            $('#run-model-button').removeClass('d-none')
            $('#run-compare-button').removeClass('d-none')

            // Scroll to the selected sentence
            $('html, body').scrollTop($("#top-1-phrase").offset().top)
          }
        });
      }
       
       
      function onRunCompareButtonClicked() {
        var paragraphText = $('#paragraphTextArea').val().trim();
        var questionText = $('#questionInput').val().trim();
        var extractorName = $('#extract_select').find(":selected").text();
        var scorerName = $('#score_select').find(":selected").val();
        var acronym = $('#acronym').is(":checked")?true:false
        var date = $('#date').is(":checked")?true:false
        var name = $('#name').is(":checked")?true:false
        var number = $('#number').is(":checked")?true:false
        
        // Hide the RunModelButton
            $('#run-model-button').addClass('d-none')
            $('#run-compare-button').addClass('d-none')

        // Show the loading animation and hide the result div
        $('#loader').removeClass('d-none')
        $('#result').addClass('d-none')

        // Make a POST request
        var data = new FormData();
        data.append('paragraph_text', paragraphText);
        data.append('question_text', questionText);
        data.append('extractor', extractorName);
        data.append('scorer', scorerName);
        data.append('acronym', acronym);
        data.append('date', date);
        data.append('name', name);
        data.append('number', number);

        let url = "compare";
        $.ajax({
          url: url,
          data: data,
          cache: false,
          contentType: false,
          processData: false,
          method: 'POST',
          success: function(data){
            $('#result-sentences-container').empty()

            var resultHTML = data['html'];
            $('#result-sentences-container').append("<p>" + resultHTML + "</p>")
             

            // The following code will enable all tooltips in the document
            $('[data-toggle="tooltip"]').tooltip();

            // Hide the loading animation and show the result div
            $('#loader').addClass('d-none')
            $('#result').removeClass('d-none')
              
            // Show the RunModelButton
            $('#run-model-button').removeClass('d-none')
            $('#run-compare-button').removeClass('d-none')

            // Scroll to the selected sentence
            $('html, body').scrollTop($("#top-1-phrase").offset().top)
          }
        });
      }
    </script>
  </body>

</html>